# 假设与需确认项 — Photo Watermark

下面列出了实现过程中我将采用的默认假设，以及需要你确认或调整的选项。

1. 路径输入行为
   - 假设：命令行位置参数 `path` 可以是单个图片文件或一个目录。
   - 默认行为：如果是目录，则只处理该目录下的文件（非递归），除非用户传入 `--recursive`。
   - 需要确认：是否希望默认开启递归？

2. 图片格式支持
   - 假设：主要支持 JPEG / JPG / PNG。对于其他格式（GIF、WEBP、TIFF 等）暂时不保证支持，但可扩展。
   - 需要确认：是否要立即包含更多格式？

3. EXIF 时间处理优先级与备选策略
   - 优先读取 EXIF 字段：`DateTimeOriginal`，其次 `DateTime`。
   - 假设默认行为：若图片没有可用 EXIF 时间，则使用文件修改时间（mtime）作为替代（可通过 `--skip-no-time` 改为跳过）。
   - 需要确认：在无 EXIF 时使用 mtime 是否为你想要的默认行为？

4. 输出目录与文件命名
   - 假设：处理后的图片保存到源目录的子目录 `<源目录>_watermark`，例如源目录 `photos` -> `photos_watermark`。
   - 假设：默认保存为新文件，文件名为原名 + `_wm`（例如 `IMG_0001.jpg` -> `IMG_0001_wm.jpg`），不覆盖原文件。
   - 需要确认：是否接受 `_wm` 后缀和不覆盖原文件的策略？或希望覆盖原文件？

5. 字体与文本样式
   - 假设：用户可以通过 `--font` 提供 TTF 字体路径；若未指定，程序在 Windows 上尝试加载系统常用字体（如 Arial），或回退到 Pillow 的默认字体。
   - 假设：字体大小以像素为单位（`--fontsize`），默认 36。
   - 需要确认：是否需要内置某个特定字体文件随包分发？（注意许可）

6. 颜色解析
   - 假设：支持 `#RRGGBB` 十六进制格式和常见颜色名（如 `white`，`black`）。
   - 需要确认：是否需要支持 alpha（透明度）通道，例如 `#RRGGBBAA`，或单独参数 `--opacity`？

7. 位置与边距
   - 假设：支持 9 个预定义位置（top-left, top-center, top-right, center-left, center, center-right, bottom-left, bottom-center, bottom-right），以及 `--margin`（像素）用于与边缘保持间距。
   - 需要确认：是否希望允许自定义坐标（像素或百分比）？

8. 小图像/边缘情况
   - 假设：若图片尺寸非常小（例如水印可能占据超过图片宽度的 40%），程序仍然绘制；但会记录警告。可后续添加跳过或自动缩放文本行为。
   - 需要确认：是否希望自动缩放字体以适配小图像？

9. 并发与性能
   - 假设：默认单线程处理；支持通过 `--workers N` 启用并发（线程池或进程池）以加速批量处理。
   - 需要确认：是否需要默认启用并发（例如等于 CPU 核心数）？

10. 错误处理与日志
    - 假设：默认行为为跳过无法处理的文件，同时在控制台/日志中记录错误（如果 `--verbose` 则更详细）。
    - 假设：遇到无法写入输出目录（权限问题）会停止处理并返回错误码。

11. EXIF 保留
    - 假设：处理后会尽量保留原图 EXIF（如果格式与库支持），但若无法保留则至少不破坏图片像素数据。
    - 需要确认：是否有必须保留的 EXIF 字段（例如原始时间、相机信息）？

12. Windows 路径与编码
    - 假设：支持 Windows 路径（示例中使用 `\` 或 `/` 都可），并以 UTF-8 处理文件名。

13. 输出质量
    - 假设：JPEG 保存默认质量 95，可通过 `--quality` 调整（1-100）。PNG 使用默认的无损保存，保留 alpha。

14. 原始图像透明度（PNG）
    - 假设：对带 alpha 的图片（PNG）进行水印时，文本应绘制在可见像素上，并保留原有透明度。

15. 原始图片大小和 DPI
    - 假设：字体大小以像素计，与 DPI 无直接耦合。若需要基于 DPI 缩放，可作为后续改进。

---

请确认上述关键假设，或指出需要修改的默认行为（例如：是否默认递归、是否使用 mtime、命名/覆盖策略、字体分发等）。确认后我会把该任务标记为完成并继续“规划实现与交付物”。
